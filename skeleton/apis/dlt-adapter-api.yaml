openapi: 3.0.1
info:
  title: Ledger Adapter Specification
  description: This is the API specification for the Ledger Adapter with whom the FinP2P Router will interact in order to execute and query the underlying implementation.
  termsOfService: 'https://ownera.io/terms/'
  contact:
    email: support@ownera.io
  version: x.x.x
tags:
  - name: payments
    description: Payments
  - name: management
    description: Management
  - name: issuance
    description: Issuance
  - name: transactions
    description: Transactions
  - name: escrow
    description: Escrow
  - name: operations
    description: Operations
  - name: health
    description: health
paths:
  /plan/approve:
    post:
      tags:
        - execution
      summary: Approve execution plan
      description: Expects a ledger to approve the upcoming execution plan
      operationId: approveExecutionPlan
      requestBody:
        content:
          application/json:
            schema:
              $ref: 'common-external-components.yaml#/components/schemas/ApproveExecutionPlanRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: 'common-external-components.yaml#/components/schemas/ApproveExecutionPlanResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /plan/proposal:
    post:
      tags:
        - execution
      summary: Approve a plan proposal plan
      description: Request adapter approval or rejection to a proposal in an execution plan
      operationId: executionPlanProposal
      requestBody:
        content:
          application/json:
            schema:
              $ref: 'common-external-components.yaml#/components/schemas/executionPlanProposalRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: 'common-external-components.yaml#/components/schemas/ApproveExecutionPlanResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /plan/proposal/status:
    post:
      tags:
        - execution
      summary: Notify the adapter on the agreement status (Approve/Rejected) for a specific proposal
      description: notify the adapter on proposal status
      operationId: executionPlanProposalStatus
      requestBody:
        content:
          application/json:
            schema:
              $ref: 'common-external-components.yaml#/components/schemas/executionPlanProposalStatusRequest'
      responses:
        '200':
          description: successful operation
          content: {}
        '204':
          description: successful operation
          content: {}
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /payments/depositInstruction:
    post:
      tags:
        - payments
      summary: Deposit instruction
      description: Create a deposit instruction for an owner
      operationId: depositInstruction
      parameters:
        - in: header
          name: Idempotency-Key
          description: hex encoding of a 32-byte payload consisting of 24 random bytes + 8-byte epoch timestamp (seconds)
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DepositInstructionRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DepositInstructionResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /payments/payout:
    post:
      tags:
        - payments
      summary: Payout request
      description: Payout owner assets to external destination
      operationId: payout
      parameters:
        - in: header
          name: Idempotency-Key
          description: hex encoding of a 32-byte payload consisting of 24 random bytes + 8-byte epoch timestamp (seconds)
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PayoutRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PayoutResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /assets/getBalance:
    post:
      deprecated: true
      tags:
        - transactions
      summary: Get asset balance
      description: Get asset balance for specified owner
      operationId: getAssetBalance
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetAssetBalanceRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetAssetBalanceResponse'
        '404':
          description: Owner not found
          content: {}
        '500':
          description: System error
          content: {}
  /assets/create:
    post:
      tags:
        - management
      summary: Create asset
      description: Create a new asset
      operationId: createAsset
      parameters:
        - in: header
          name: Idempotency-Key
          description: hex encoding of a 32-byte payload consisting of 24 random bytes + 8-byte epoch timestamp (seconds)
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAssetRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateAssetResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /assets/issue:
    post:
      tags:
        - issuance
      summary: Issue asset token
      description: Issue specified amount of asset tokens for the owner
      operationId: issueAssets
      parameters:
        - in: header
          name: Idempotency-Key
          description: hex encoding of a 32-byte payload consisting of 24 random bytes + 8-byte epoch timestamp (seconds)
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IssueAssetsRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IssueAssetsResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /assets/redeem:
    post:
      tags:
        - issuance
      summary: Asset Token Redeem
      description: Redeem existing asset token for new owner. Redeem of ownership is done by eliminating existing tokens owned by the owner.
      operationId: redeemAssets
      parameters:
        - in: header
          name: Idempotency-Key
          description: hex encoding of a 32-byte payload consisting of 24 random bytes + 8-byte epoch timestamp (seconds)
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RedeemAssetsRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RedeemAssetsResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /assets/transfer:
    post:
      tags:
        - transactions
      summary: Asset Token Transfer
      description: Transfer existing asset token to a new owner. Transfer of ownership is done by eliminating existing tokens owned by the sender and creating new tokens with the new owner.
      operationId: transferAsset
      parameters:
        - in: header
          name: Idempotency-Key
          description: hex encoding of a 32-byte payload consisting of 24 random bytes + 8-byte epoch timestamp (seconds)
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferAssetRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransferAssetResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /assets/receipts/{transactionId}:
    get:
      tags:
        - transactions
      summary: Get Receipt
      description: Get asset transaction receipt
      operationId: getReceipt
      parameters:
        - name: transactionId
          in: path
          description: ID of the asset transaction
          required: true
          schema:
            type: string
            pattern: .*\S.*
            x-autoMinLength: true
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetReceiptResponse'
        '404':
          description: Transaction not found
          content: {}
        '500':
          description: System error
          content: {}
  /assets/hold:
    post:
      tags:
        - escrow
      summary: Hold Asset
      description: Hold the owner asset
      operationId: holdOperation
      parameters:
        - in: header
          name: Idempotency-Key
          description: hex encoding of a 32-byte payload consisting of 24 random bytes + 8-byte epoch timestamp (seconds)
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HoldOperationRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HoldOperationResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /assets/release:
    post:
      tags:
        - escrow
      summary: Release Asset
      description: Release held assets
      operationId: releaseOperation
      parameters:
        - in: header
          name: Idempotency-Key
          description: hex encoding of a 32-byte payload consisting of 24 random bytes + 8-byte epoch timestamp (seconds)
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReleaseOperationRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseOperationResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /assets/rollback:
    post:
      tags:
        - escrow
      summary: Rollback held asset
      description: Release back held asset to the owner
      operationId: rollbackOperation
      parameters:
        - in: header
          name: Idempotency-Key
          description: hex encoding of a 32-byte payload consisting of 24 random bytes + 8-byte epoch timestamp (seconds)
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RollbackOperationRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RollbackOperationResponse'
        '400':
          description: Invalid Input
          content: {}
        '500':
          description: System error
          content: {}
  /operations/status/{cid}:
    get:
      tags:
        - operations
      summary: 'Get Operation Status'
      description: 'Get the operation status by an operation correlation id'
      operationId: getOperation
      parameters:
        - name: cid
          in: path
          description: 'correlation id of an operation'
          required: true
          schema:
            type: string
            x-allowEmpty: true
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetOperationStatusResponse'
        '404':
          description: Transaction not found
          content: {}
        '500':
          description: System error
          content: {}
  /asset/balance:
    post:
      tags:
        - transactions
      summary: Get asset balance information
      description: Get asset balance information for finId
      operationId: GetAssetBalanceInfo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssetBalanceInfoRequest'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetBalanceInfoResponse'
        '404':
          description: Owner not found
          content: {}
        '500':
          description: System error
          content: {}
  /health:
    get:
      summary: Health check
      description: Returns the health status of the service.
      operationId: getHealth
      tags:
        - health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                    pattern: .*\S.*
                    x-autoMinLength: true
        '503':
          description: Service is unavailable
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: unavailable
                    pattern: .*\S.*
                    x-autoMinLength: true
components:
  schemas:
    DepositInstructionRequest:
      type: object
      required:
        - destination
        - owner
        - asset
      properties:
        destination:
          $ref: '#/components/schemas/destination'
        owner:
          $ref: '#/components/schemas/source'
        asset:
          $ref: '#/components/schemas/depositAsset'
        amount:
          type: string
          description: Amount to deposit
          pattern: .*\S.*
          x-autoMinLength: true
        details:
          type: object
        nonce:
          $ref: '#/components/schemas/nonce'
        signature:
          $ref: '#/components/schemas/signature'
    DepositInstructionResponse:
      allOf:
        - $ref: '#/components/schemas/depositOperation'
    PayoutRequest:
      type: object
      required:
        - source
        - quantity
        - asset
      properties:
        source:
          $ref: '#/components/schemas/source'
        destination:
          $ref: '#/components/schemas/destination'
        quantity:
          type: string
          description: 'How many units of the asset'
          pattern: .*\S.*
          x-autoMinLength: true
        payoutInstruction:
          $ref: '#/components/schemas/payoutInstruction'
        asset:
          $ref: '#/components/schemas/payoutAsset'
        nonce:
          $ref: '#/components/schemas/nonce'
        signature:
          $ref: '#/components/schemas/signature'
    PayoutResponse:
      allOf:
        - $ref: '#/components/schemas/receiptOperation'
    GetAssetBalanceRequest:
      type: object
      required:
        - owner
        - asset
      properties:
        owner:
          $ref: '#/components/schemas/source'
        asset:
          $ref: '#/components/schemas/asset'
    GetAssetBalanceResponse:
      allOf:
        - $ref: '#/components/schemas/balance'
    CreateAssetRequest:
      type: object
      required:
        - asset
      properties:
        metadata:
          type: object
          description: The asset metadata
          additionalProperties: true
        asset:
          $ref: '#/components/schemas/asset'
        ledgerAssetBinding:
          $ref: '#/components/schemas/ledgerAssetBinding'
        name:
          $ref: 'common-external-components.yaml#/components/schemas/assetName'
        issuerId:
          $ref: 'common-external-components.yaml#/components/schemas/ownerResourceId'
        denomination:
          $ref: 'common-external-components.yaml#/components/schemas/assetDenomination'
        assetIdentifier:
          $ref: 'common-external-components.yaml#/components/schemas/assetIdentifier'
    CreateAssetResponse:
      allOf:
        - $ref: 'common-external-components.yaml#/components/schemas/OperationBase'
        - type: object
          properties:
            error:
              $ref: '#/components/schemas/createAssetOperationErrorInformation'
            response:
              $ref: '#/components/schemas/assetCreateResponse'
    IssueAssetsRequest:
      type: object
      required:
        - nonce
        - destination
        - quantity
        - asset
        - settlementRef
        - signature
      properties:
        nonce:
          $ref: '#/components/schemas/nonce'
        destination:
          $ref: '#/components/schemas/finIdAccount'
        quantity:
          type: string
          description: 'How many units of the asset tokens'
          pattern: .*\S.*
          x-autoMinLength: true
        asset:
          $ref: '#/components/schemas/finp2pAsset'
        settlementRef:
          type: string
          description: 'Reference to the corresponding settlement operation'
          pattern: .*\S.*
          x-autoMinLength: true
        signature:
          $ref: '#/components/schemas/signature'
        executionContext:
          $ref: '#/components/schemas/executionContext'
    IssueAssetsResponse:
      allOf:
        - $ref: '#/components/schemas/receiptOperation'
    RedeemAssetsRequest:
      type: object
      required:
        - nonce
        - source
        - quantity
        - asset
        - settlementRef
        - signature
      properties:
        nonce:
          $ref: '#/components/schemas/nonce'
        operationId:
          type: string
          x-go-type-skip-optional-pointer: true
          pattern: .*\S.*
          x-autoMinLength: true
        source:
          $ref: '#/components/schemas/finIdAccount'
        quantity:
          type: string
          description: 'How many units of the asset tokens'
          pattern: .*\S.*
          x-autoMinLength: true
        asset:
          $ref: '#/components/schemas/finp2pAsset'
        settlementRef:
          type: string
          description: 'Reference to the corresponding payment operation'
          pattern: .*\S.*
          x-autoMinLength: true
        signature:
          $ref: '#/components/schemas/signature'
        executionContext:
          $ref: '#/components/schemas/executionContext'
    RedeemAssetsResponse:
      allOf:
        - $ref: '#/components/schemas/receiptOperation'
    TransferAssetRequest:
      type: object
      required:
        - nonce
        - source
        - destination
        - quantity
        - asset
        - settlementRef
        - signature
      properties:
        nonce:
          $ref: '#/components/schemas/nonce'
        source:
          $ref: '#/components/schemas/source'
        destination:
          $ref: '#/components/schemas/destination'
        quantity:
          type: string
          description: 'How many units of the asset tokens'
          pattern: .*\S.*
          x-autoMinLength: true
        asset:
          $ref: '#/components/schemas/asset'
        settlementRef:
          type: string
          description: 'Reference to the corresponding payment operation'
          pattern: .*\S.*
          x-autoMinLength: true
        signature:
          $ref: '#/components/schemas/signature'
        executionContext:
          $ref: '#/components/schemas/executionContext'
    TransferAssetResponse:
      allOf:
        - $ref: '#/components/schemas/receiptOperation'
    GetReceiptResponse:
      allOf:
        - $ref: '#/components/schemas/receiptOperation'
    HoldOperationRequest:
      type: object
      required:
        - nonce
        - operationId
        - source
        - quantity
        - asset
        - expiry
        - signature
      properties:
        nonce:
          $ref: '#/components/schemas/nonce'
        operationId:
          type: string
          description: 'Escrow operation id'
          pattern: .*\S.*
          x-autoMinLength: true
        source:
          $ref: '#/components/schemas/source'
        destination:
          $ref: '#/components/schemas/destination'
        quantity:
          type: string
          description: 'How many units of the asset tokens'
          pattern: .*\S.*
          x-autoMinLength: true
        asset:
          $ref: '#/components/schemas/asset'
        expiry:
          type: integer
          format: uint64
          description: 'ttl expiry value indicating the escrow hold time limitation'
        signature:
          $ref: '#/components/schemas/signature'
        executionContext:
          $ref: '#/components/schemas/executionContext'
    HoldOperationResponse:
      allOf:
        - $ref: '#/components/schemas/receiptOperation'
    ReleaseOperationRequest:
      type: object
      required:
        - operationId
        - source
        - destination
        - quantity
        - asset
      properties:
        operationId:
          type: string
          description: 'Hold operation id'
          pattern: .*\S.*
          x-autoMinLength: true
        source:
          $ref: '#/components/schemas/source'
        destination:
          $ref: '#/components/schemas/destination'
        quantity:
          type: string
          description: 'How many units of the asset tokens'
          pattern: .*\S.*
          x-autoMinLength: true
        asset:
          $ref: '#/components/schemas/asset'
        executionContext:
          $ref: '#/components/schemas/executionContext'
    ReleaseOperationResponse:
      allOf:
        - $ref: '#/components/schemas/receiptOperation'
    RollbackOperationRequest:
      type: object
      required:
        - operationId
        - source
        - quantity
        - asset
      properties:
        operationId:
          type: string
          description: 'Hold operation id'
          pattern: .*\S.*
          x-autoMinLength: true
        source:
          $ref: '#/components/schemas/source'
        quantity:
          type: string
          description: 'How many units of the asset tokens'
          pattern: .*\S.*
          x-autoMinLength: true
        asset:
          $ref: '#/components/schemas/asset'
        executionContext:
          $ref: '#/components/schemas/executionContext'
    RollbackOperationResponse:
      allOf:
        - $ref: '#/components/schemas/receiptOperation'
    GetOperationStatusRequest:
      type: object
      properties:
        cid:
          type: string
          description: 'correlation id of an operation'
          x-allowEmpty: true
    GetOperationStatusResponse:
      $ref: '#/components/schemas/operationStatus'
    nonce:
      type: string
      description: |
        32 bytes buffer (24 randomly generated bytes by the client + 8 bytes epoch timestamp seconds) encoded to hex:

          const nonce = Buffer.alloc(32);
          nonce.fill(crypto.randomBytes(24), 0, 24);

          const nowEpochSeconds = Math.floor(new Date().getTime() / 1000);
          const t = BigInt(nowEpochSeconds);
          nonce.writeBigInt64BE(t, 24);
      x-allowEmpty: true
    depositInstruction:
      required:
        - account
      type: object
      properties:
        account:
          $ref: '#/components/schemas/destination'
        description:
          type: string
          description: 'Instructions for the deposit operation'
          pattern: .*\S.*
          x-autoMinLength: true
        paymentOptions:
          $ref: 'common-external-components.yaml#/components/schemas/paymentMethods'
        details:
          deprecated: true
          type: object
          description: Any addition deposit specific information, deprecated use "payment method options" instead fields
        operationId:
          type: string
          description: operation id reference while will correlate with any receipt associated with the deposit operation
          pattern: .*\S.*
          x-autoMinLength: true
    asset:
      type: object
      discriminator:
        propertyName: type
        mapping:
          cryptocurrency: '#/components/schemas/cryptocurrencyAsset'
          fiat: '#/components/schemas/fiatAsset'
          finp2p: '#/components/schemas/finp2pAsset'
      oneOf:
        - $ref: '#/components/schemas/cryptocurrencyAsset'
        - $ref: '#/components/schemas/fiatAsset'
        - $ref: '#/components/schemas/finp2pAsset'
    depositAsset:
      type: object
      discriminator:
        propertyName: type
        mapping:
          cryptocurrency: '#/components/schemas/cryptocurrencyAsset'
          fiat: '#/components/schemas/fiatAsset'
          finp2p: '#/components/schemas/finp2pAsset'
          custom: '#/components/schemas/customAsset'
      oneOf:
        - $ref: '#/components/schemas/cryptocurrencyAsset'
        - $ref: '#/components/schemas/fiatAsset'
        - $ref: '#/components/schemas/finp2pAsset'
        - $ref: '#/components/schemas/customAsset'
    payoutAsset:
      type: object
      discriminator:
        propertyName: type
        mapping:
          cryptocurrency: '#/components/schemas/cryptocurrencyAsset'
          fiat: '#/components/schemas/fiatAsset'
          finp2p: '#/components/schemas/finp2pAsset'
      oneOf:
        - $ref: '#/components/schemas/cryptocurrencyAsset'
        - $ref: '#/components/schemas/fiatAsset'
        - $ref: '#/components/schemas/finp2pAsset'
    payoutInstruction:
      type: object
      required:
        - description
      properties:
        description:
          type: string
          description: 'withdrawal description'
          pattern: .*\S.*
          x-autoMinLength: true
    cryptocurrencyAsset:
      type: object
      required:
        - type
        - code
      properties:
        type:
          type: "string"
          enum: ["cryptocurrency"]
        code:
          type: "string"
          description: 'unique identifier symbol of the cryptocurrency'
          pattern: .*\S.*
          x-autoMinLength: true
    fiatAsset:
      type: object
      required:
        - type
        - code
      properties:
        type:
          type: "string"
          enum: ["fiat"]
        code:
          type: "string"
          description: 'unique identifier code of the fiat currency - based on ISO-4217'
          pattern: .*\S.*
          x-autoMinLength: true
    finp2pAsset:
      type: object
      required:
        - type
        - resourceId
      properties:
        type:
          type: "string"
          enum: ["finp2p"]
        resourceId:
          type: "string"
          description: |
            Unique resource ID of the FinP2P asset [format]('https://finp2p.atlassian.net/wiki/spaces/FINP2P/pages/67764240/FinP2P+Network+Interface+Specification#ResourceID-format')
          pattern: .*\S.*
          x-autoMinLength: true
    customAsset:
      type: object
      required:
        - type
      properties:
        type:
          type: "string"
          enum: ["custom"]
    source:
      type: object
      required:
        - finId
        - account
      properties:
        finId:
          $ref: "common-external-components.yaml#/components/schemas/finId"
        account:
          oneOf:
            - $ref: '#/components/schemas/finIdAccount'
          discriminator:
            propertyName: type
            mapping:
              finId: '#/components/schemas/finIdAccount'
    destination:
      description: 'describes destination for remote operations operations'
      type: object
      required:
        - finId
        - account
      properties:
        finId:
          $ref: "common-external-components.yaml#/components/schemas/finId"
        account:
          oneOf:
            - $ref: '#/components/schemas/finIdAccount'
            - $ref: '#/components/schemas/cryptoWalletAccount'
            - $ref: '#/components/schemas/fiatAccount'
          discriminator:
            propertyName: type
            mapping:
              finId: '#/components/schemas/finIdAccount'
              cryptoWallet: '#/components/schemas/cryptoWalletAccount'
              fiatAccount: '#/components/schemas/fiatAccount'
    finIdAccount:
      type: object
      required:
        - finId
        - type
      properties:
        type:
          type: string
          enum: ["finId"]
        finId:
          $ref: "common-external-components.yaml#/components/schemas/finId"
    cryptoWalletAccount:
      type: object
      required:
        - type
        - address
      properties:
        type:
          type: string
          enum: ["cryptoWallet"]
        address:
          type: "string"
          description: 'address of the cryptocurrency wallet'
          pattern: .*\S.*
          x-autoMinLength: true
    fiatAccount:
      type: object
      required:
        - type
        - code
      properties:
        type:
          type: string
          enum: ["fiatAccount"]
        code:
          type: "string"
          description: 'IBAN or other code to represent a fiat account'
          pattern: .*\S.*
          x-autoMinLength: true
    balance:
      type: object
      required:
        - asset
        - balance
      properties:
        asset:
          $ref: '#/components/schemas/asset'
        balance:
          type: string
          description: the number of asset tokens
          pattern: .*\S.*
          x-autoMinLength: true
    receiptOperation:
      allOf:
        - $ref: 'common-external-components.yaml#/components/schemas/OperationBase'
        - type: object
          properties:
            error:
              $ref: '#/components/schemas/receiptOperationErrorInformation'
            response:
              $ref: '#/components/schemas/receipt'
    createAssetOperation:
      allOf:
        - $ref: 'common-external-components.yaml#/components/schemas/OperationBase'
        - type: object
          properties:
            error:
              $ref: '#/components/schemas/createAssetOperationErrorInformation'
            response:
              $ref: '#/components/schemas/assetCreateResponse'
    assetCreateResponse:
      type: object
      required:
        - ledgerAssetInfo
      properties:
        ledgerAssetInfo:
          $ref: '#/components/schemas/ledgerAssetInfo'
    depositOperation:
      allOf:
        - $ref: 'common-external-components.yaml#/components/schemas/OperationBase'
        - type: object
          properties:
            error:
              $ref: '#/components/schemas/depositOperationErrorInformation'
            response:
              $ref: '#/components/schemas/depositInstruction'
    depositOperationErrorInformation:
      type: object
      properties: {}
    createAssetOperationErrorInformation:
      type: object
      properties:
        code:
          type: integer
          format: uint32
        message:
          type: string
          pattern: .*\S.*
          x-autoMinLength: true
    receiptOperationErrorInformation:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: integer
          format: uint32
          description: 1 for failure in regApps validation, 4 failure in signature verification
        message:
          type: string
          pattern: .*\S.*
          x-autoMinLength: true
        regulationErrorDetails:
          type: array
          items:
            $ref: 'common-external-components.yaml#/components/schemas/RegulationError'
    executionOperationErrorInformation:
      type: object
      properties: {}
    executionContext:
      type: object
      required:
        - executionPlanId
        - instructionSequenceNumber
      properties:
        executionPlanId:
          type: string
          description: execution plan id
          pattern: .*\S.*
          x-autoMinLength: true
        instructionSequenceNumber:
          type: integer
          format: uint32
          description: execution instruction sequence number
    operationStatus:
      type: object
      oneOf:
        - $ref: '#/components/schemas/operationStatusCreateAsset'
        - $ref: '#/components/schemas/operationStatusDeposit'
        - $ref: '#/components/schemas/operationStatusReceipt'
        - $ref: '#/components/schemas/operationStatusApproval'
      discriminator:
        propertyName: type
        mapping:
          createAsset: '#/components/schemas/operationStatusCreateAsset'
          deposit: '#/components/schemas/operationStatusDeposit'
          receipt: '#/components/schemas/operationStatusReceipt'
          approval: '#/components/schemas/operationStatusApproval'
    operationStatusCreateAsset:
      type: object
      required:
        - type
        - operation
      properties:
        type:
          type: string
          enum: [createAsset]
        operation:
          $ref: '#/components/schemas/createAssetOperation'
    operationStatusDeposit:
      type: object
      required:
        - type
        - operation
      properties:
        type:
          type: string
          enum: [deposit]
        operation:
          $ref: '#/components/schemas/depositOperation'
    operationStatusReceipt:
      type: object
      required:
        - type
        - operation
      properties:
        type:
          type: string
          enum: [receipt]
        operation:
          $ref: '#/components/schemas/receiptOperation'
    operationStatusApproval:
      type: object
      required:
        - type
        - operation
      properties:
        type:
          type: string
          enum: [approval]
        operation:
          $ref: 'common-external-components.yaml#/components/schemas/ExecutionPlanApprovalOperation'
    signature:
      type: object
      required: [signature, template, hashFunc]
      description: 'represent a signature template information'
      properties:
        signature:
          type: string
          description: 'hex representation of the signature'
          pattern: .*\S.*
          x-autoMinLength: true
        template:
          $ref: '#/components/schemas/signatureTemplate'
        hashFunc:
          $ref: '#/components/schemas/hashFunction'
    signatureTemplate:
      type: object
      oneOf:
        - $ref: '#/components/schemas/hashListTemplate'
        - $ref: '#/components/schemas/EIP712Template'
      discriminator:
        propertyName: type
        mapping:
          hashList: '#/components/schemas/hashListTemplate'
          EIP712: '#/components/schemas/EIP712Template'
    hashListTemplate:
      description: 'ordered list of hash groups'
      required: [type, hashGroups, hash]
      type: object
      properties:
        type:
          type: string
          enum: ["hashList"]
        hashGroups:
          type: array
          items:
            $ref: '#/components/schemas/hashGroup'
        hash:
          type: string
          description: 'hex representation of the combined hash groups hash value'
          x-allowEmpty: true
    hashGroup:
      type: object
      required:
        - hash
        - fields
      properties:
        hash:
          type: string
          description: 'hex representation of the hash group hash value'
          x-allowEmpty: true
        fields:
          description: 'list of fields by order they appear in the hash group'
          type: array
          items:
            $ref: '#/components/schemas/field'
    field:
      type: object
      description: 'describing a field in the hash group'
      required:
        - name
        - type
        - value
      properties:
        name:
          type: string
          description: 'name of field'
          pattern: .*\S.*
          x-autoMinLength: true
        type:
          type: string
          enum: ["string", "int", "bytes"]
          description: 'type of field'
        value:
          type: string
          description: 'hex representation of the field value'
          x-allowEmpty: true
    EIP712Domain:
      type: object
      properties:
        name:
          type: string
          x-allowEmpty: true
        version:
          type: string
          x-allowEmpty: true
        chainId:
          type: integer
          format: uint64
        verifyingContract:
          type: string
          format: address
          x-allowEmpty: true
    EIP712TypedValue:
      oneOf:
        - $ref: '#/components/schemas/EIP712TypeString'
        - $ref: '#/components/schemas/EIP712TypeInteger'
        - $ref: '#/components/schemas/EIP712TypeBool'
        - $ref: '#/components/schemas/EIP712TypeByte'
        - $ref: '#/components/schemas/EIP712TypeObject'
        - $ref: '#/components/schemas/EIP712TypeArray'
    EIP712Types:
      type: object
      properties:
        definitions:
          type: array
          items:
            $ref: '#/components/schemas/EIP712TypeDefinition'
    EIP712TypeDefinition:
      type: object
      properties:
        name:
          type: string
          x-allowEmpty: true
        fields:
          type: array
          items:
            $ref: '#/components/schemas/EIP712FieldDefinition'
    EIP712FieldDefinition:
      type: object
      properties:
        name:
          type: string
          x-allowEmpty: true
        type:
          type: string
          x-allowEmpty: true
    EIP712Template:
      required: [type, domain, message, primaryType, types, hash]
      type: object
      properties:
        type:
          type: string
          enum: ["EIP712"]
        domain:
          $ref: '#/components/schemas/EIP712Domain'
        message:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/EIP712TypedValue'
        types:
          $ref: '#/components/schemas/EIP712Types'
        primaryType:
          type: string
          x-allowEmpty: true
        hash:
          type: string
          description: 'hex representation of template hash'
          x-allowEmpty: true
    EIP712TypeString:
      type: string
      pattern: '^(?:$|0([^x].*)?|[^0].*)$' # matches string that doesn't start with hexadecimal prefix
      x-allowEmpty: true
    EIP712TypeByte:
      type: string
      pattern: '^0x[0-9a-fA-F]+$' # matches hexadecimal string starting with '0x'
      minLength: 3
      maxLength: 320
    EIP712TypeInteger:
      type: integer
    EIP712TypeBool:
      type: boolean
    EIP712TypeObject:
      type: object
      additionalProperties:
        $ref: '#/components/schemas/EIP712TypedValue'
    EIP712TypeArray:
      type: array
      items:
        $ref: '#/components/schemas/EIP712TypedValue'
    hashFunction:
      type: string
      enum:
        - unspecified
        - sha3_256
        - sha3-256
        - blake2b
        - keccak_256
        - keccak-256
      description: hash function types
    receipt:
      type: object
      required:
        - id
        - asset
        - quantity
        - timestamp
        - tradeDetails
      properties:
        id:
          type: string
          description: the receipt id
          pattern: .*\S.*
          x-autoMinLength: true
        asset:
          $ref: '#/components/schemas/asset'
        quantity:
          type: string
          description: 'How many units of the asset tokens'
          pattern: .*\S.*
          x-autoMinLength: true
        timestamp:
          type: integer
          format: int64
          description: transaction timestamp
        source:
          $ref: '#/components/schemas/source'
        destination:
          $ref: '#/components/schemas/destination'
        transactionDetails:
          $ref: '#/components/schemas/transactionDetails'
        operationType:
          $ref: '#/components/schemas/operationType'
        tradeDetails:
          $ref: '#/components/schemas/receiptTradeDetails'
        proof:
          $ref: '#/components/schemas/proofPolicy'
    receiptTradeDetails:
      type: object
      properties:
        intentId:
          type: string
          pattern: .*\S.*
          x-autoMinLength: true
        intentVersion:
          type: string
          pattern: .*\S.*
          x-autoMinLength: true
        executionContext:
          $ref: '#/components/schemas/receiptExecutionContext'
    receiptExecutionContext:
      type: object
      required: [executionPlanId, instructionSequenceNumber]
      properties:
        executionPlanId:
          type: string
          pattern: .*\S.*
          x-autoMinLength: true
        instructionSequenceNumber:
          type: integer
    proofPolicy:
      description: additional proof information attached to a receipt
      type: object
      discriminator:
        propertyName: type
        mapping:
          signatureProofPolicy: '#/components/schemas/signatureProofPolicy'
          noProofPolicy: '#/components/schemas/noProofPolicy'
      oneOf:
        - $ref: '#/components/schemas/signatureProofPolicy'
        - $ref: '#/components/schemas/noProofPolicy'
    noProofPolicy:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum: ["noProofPolicy"]
      description: "no proof validation required for this policy"
    signatureProofPolicy:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum: ["signatureProofPolicy"]
        signature:
          $ref: '#/components/schemas/signature'
    transactionDetails:
      description: additional ledger specific
      type: object
      required:
        - transactionId
      properties:
        transactionId:
          type: string
          description: The Transaction id on the underlying ledger
          pattern: .*\S.*
          x-autoMinLength: true
        operationId:
          type: string
          description: The Operation id
          pattern: .*\S.*
          x-autoMinLength: true
    operationType:
      type: string
      enum: ['issue', 'transfer', 'hold', 'release', 'redeem']
    ledgerAssetInfo:
      type: object
      required: [ledgerTokenId]
      properties:
        ledgerTokenId:
          $ref: '#/components/schemas/ledgerTokenId'
        ledgerReference:
          oneOf:
            - $ref: '#/components/schemas/contractDetails'
          discriminator:
            propertyName: type
            mapping:
              contractDetails: '#/components/schemas/contractDetails'
    contractDetails:
      type: object
      required: [network, address, type]
      properties:
        type:
          type: string
          description: 'the type of the identifier'
          enum: ["contractDetails"]
        network:
          type: string
          description: 'the network'
          pattern: .*\S.*
          x-autoMinLength: true
        address:
          type: string
          description: 'the address'
          pattern: .*\S.*
          x-autoMinLength: true
        TokenStandard:
          type: string
          description: 'The standard of the token (e.g., ERC20, ERC721)'
          pattern: .*\S.*
          x-autoMinLength: true
        additionalContractDetails:
          anyOf:
            - $ref: '#/components/schemas/finP2PEVMOperatorDetails'
    finP2PEVMOperatorDetails:
      type: object
      properties:
        FinP2POperatorContractAddress:
          type: string
          description: 'The FinP2P Operator Contract Address'
          pattern: .*\S.*
          x-autoMinLength: true
        allowanceRequired:
          type: boolean
          description: 'Indicates if allowance is required'
    ledgerAssetBinding:
      type: object
      oneOf:
        - $ref: '#/components/schemas/ledgerTokenId'
      discriminator:
        propertyName: type
        mapping:
          tokenId: '#/components/schemas/ledgerTokenId'
    ledgerTokenId:
      type: object
      required: [tokenId, type]
      properties:
        type:
          type: string
          description: 'the type of the identifier'
          enum: ["tokenId"]
        tokenId:
          type: string
          description: 'the token id binding'
          pattern: .*\S.*
          x-autoMinLength: true
    AssetBalanceInfoRequest:
      type: object
      required:
        - account
        - asset
      properties:
        account:
          $ref: '#/components/schemas/assetBalanceAccount'
        asset:
          $ref: '#/components/schemas/asset'
        marker:
          $ref: '#/components/schemas/balanceMarker'
    assetBalanceAccount:
      oneOf:
        - $ref: '#/components/schemas/finIdAccount'
      discriminator:
        propertyName: type
        mapping:
          finId: '#/components/schemas/finIdAccount'
    balanceMarker:
      description: marker of balance to denote the balance as of marker
      discriminator:
        propertyName: type
        mapping:
          timestamp: '#/components/schemas/balanceMarkerTimestamp'
          transactionBlock: '#/components/schemas/balanceMarkerTransactionBlock'
      oneOf:
        - $ref: '#/components/schemas/balanceMarkerTimestamp'
        - $ref: '#/components/schemas/balanceMarkerTransactionBlock'
    balanceMarkerTimestamp:
      type: object
      required: [type, timestamp]
      properties:
        type:
          type: string
          enum: [timestamp]
        timestamp:
          type: integer
          format: int64
          description: epoch timestamp in seconds
    balanceMarkerTransactionBlock:
      type: object
      required: [type, blockNumber, transaction]
      properties:
        type:
          type: string
          enum: [transactionBlock]
        blockNumber:
          type: integer
          format: int64
        transaction:
          type: string
          pattern: .*\S.*
          x-autoMinLength: true
    AssetBalanceInfoResponse:
      type: object
      required:
        - account
        - asset
      properties:
        account:
          $ref: '#/components/schemas/assetBalanceAccount'
        asset:
          $ref: '#/components/schemas/asset'
        balanceInfo:
          $ref: '#/components/schemas/assetBalance'
    assetBalance:
      type: object
      required:
        - asset
        - current
        - available
        - held
      properties:
        asset:
          $ref: '#/components/schemas/asset'
        current:
          type: string
          format: '^-?\d+(\.\d+)?$'
          description: The total amount currently in or owed by the account
          pattern: .*\S.*
          x-autoMinLength: true
        available:
          type: string
          format: '^-?\d+(\.\d+)?$'
          description: The amount immediately usable from the account
          pattern: .*\S.*
          x-autoMinLength: true
        held:
          type: string
          format: '^-?\d+(\.\d+)?$'
          description: The amount pending or on hold within the account
          pattern: .*\S.*
          x-autoMinLength: true
        receipts:
          description: list of receipt associated with the balance info
          type: array
          items:
            $ref: '#/components/schemas/receipt'
